# 布料模拟

## Summary

传统的布料模拟使用的是基于力的做法，其基本步骤为：
* 根据位置约束计算出质点受力
* 根据受力计算出加速度
* 利用加速度迭代速度
* 利用速度迭代位置

但这种模拟方式需要较小的迭代步长，计算量较大，所以我使用了Position Base Dynamics算法，同时使用了unity的Job System进行并行计算，该算法的优点是可以使用较大的迭代步长，并且Job System配合Burst编译，性能非常可观。

![](https://s2.loli.net/2022/01/12/LN5cxovImlHegJj.gif)

## PBD(Position Base Dynamics) Process

PBD算法的流程如下

![](https://pic3.zhimg.com/80/v2-cfa71169bcab6c7cf3c6c7f8041e61ee_720w.jpg)

图中x为当前质点位置,p为预测质点位置。可以看到:

* 算法在每一帧开始时，会根据外力和阻尼先于计算一个位置(p)
* 根据当前位置(x)和预测位置(p)，去进行碰撞检测，如果发现有碰撞，就生成一个碰撞约束
* 迭代求解所有约束，最终会得到新预测位置p
* 利用p - x 来计算速度v，并将p赋值给x
* 最后再计算一遍速度(处理碰撞反弹之类速度变换)

### 外部力和约束的定义

像重力、风、可以视为外部力，但是像质点之间的相互作用我们通常视为内部约束，而非力。同样外部物体对质点的碰撞，也视为碰撞约束而不是外部力。

### 质点及布料模型

### 质量生成算法

### 预测位置计算


## Collisions

### 球体碰撞

### 胶囊碰撞

### 平行六面体

### Collision Job

## Constraints

### 距离约束

### 弯曲约束

### 固定约束

### 碰撞约束

## Iterations

### 约束迭代

### 更新质点位置和速度

### 布料对外部物体施加力

## Todo

### 连续碰撞检测

### 布料破坏

### 自相交

# Liquid

todo